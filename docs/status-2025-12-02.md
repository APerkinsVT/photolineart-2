# PhotoLineArt Status — 2025-12-02

## What’s shipping
- **Landing page (dev + prod):** Single-photo flow works end-to-end. Users upload, get line art + palette + tips, download a 2-page PDF, and receive the PDF via email. Free-tier assets are deleted immediately after send.
- **Built bundle served correctly:** Vercel now serves the Vite-built `dist` with hashed assets; MIME issues resolved.
- **API availability:** `/api/blob-upload`, `/api/ai-lineart`, `/api/send-pdf`, and `/api/delete-asset` are live.
- **Email delivery:** SMTP (Namecheap) sends PDF attachments from `team@photolineart.com` with a privacy note and link back to photolineart.com.
- **Palette source of truth:** Faber-Castell colors come from `public/palettes/faber-castell-polychromos.json` + PNG swatches in `public/swatches/` for both UI and PDF.
- **PDFs:** Playfair/Inter embedded; 2-page layout (line art page + info page with reference photo, palette swatches, tips). Free assets are deleted after download/email.

## Tech stack (current)
- **Frontend:** React + TypeScript + Vite, React Router, custom CSS (`photolineart.css`).
- **Build/deploy:** Vercel (Vite preset, no overrides). Static build to `dist`; API routes as Vercel Node functions.
- **APIs:** `/api/blob-upload` (Vercel Blob signed upload), `/api/ai-lineart` (Replicate line art + analysis), `/api/send-pdf` (nodemailer SMTP), `/api/delete-asset` (Blob cleanup).
- **Storage:** Vercel Blob for uploads/line art/manifest-like artifacts.
- **AI:** Replicate for line art; OpenAI for tips/palette matching (as implemented in `aiService`/`ai-lineart`).
- **PDF:** jsPDF (`pdfBuilder.ts`) with embedded Playfair/Inter; uses swatch PNGs; free flow deletes assets after send.
- **Email:** Nodemailer over Namecheap SMTP (`SMTP_HOST=mail.privateemail.com`, user `team@photolineart.com`).

## Current known issues / risks
- **Chunk size warning:** Main bundle ~730 KB (gzip ~235 KB). Not breaking, but consider code-splitting to shrink initial load.
- **API credentials:** Ensure Vercel prod has all envs (Blob token, Replicate, OpenAI, SMTP).
- **Deletion timing:** Free-tier deletes immediately after send; ensure we skip deletion for future paid/portal flows.
- **Portal/book flow:** Legacy portal/bundle code exists but isn’t wired in prod; not yet tested post-refactors.

## Near-term workplan
1) **Stabilize prod APIs:** Verify `/api/ai-lineart` and `/api/blob-upload` latency/error handling; add user-friendly errors for 5xx.
2) **Bundle size:** Add lazy-loading/code-splitting to reduce the main chunk (<500 KB target).
3) **Portal/paid tier:** Re-enable publish/manifest/book download and protect against deletion for paid items.
4) **Email template:** Optional HTML template; add portal link when paid tier ships.
5) **Monitoring:** Add basic logging/alerting around API errors and email send failures.

## How to redeploy safely
- Keep Vercel preset = **Vite**, no overrides, no custom routes.
- Avoid `vercel.json` unless necessary; if used, keep only builders (static + api) without routes.
- After deploy, verify:
  - View-source shows `/assets/index-*.js` (not `/src/main.tsx`).
  - `/api/blob-upload` returns a 405/200 (not 404).
  - Landing upload → PDF download/email works end-to-end.
